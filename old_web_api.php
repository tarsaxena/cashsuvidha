<?php session_start();
      include('model.php');
	  $server = 'localhost';
	  //$username = 'root';//$pass = 'bccNQJ{R~UnW';//$pass = '';//$db = 'cash_suvidha_dummy';$db = 'cashsuvidhadb';$username = 'cashsuvidbadmin';$pass = 'Pass@csdbadmin';$conn = mysql_connect($server, $username, $pass);if (!$conn) {    die("Couldn't Connect - " . mysql_error());} else {    mysql_select_db($db, $conn);}// For Base Url$root = str_replace(basename($_SERVER['SCRIPT_NAME']), "", $_SERVER['SCRIPT_NAME']);$base_url = $_SERVER['SERVER_NAME'] . $root;$GLOBALS['base_url'] = $base_url;// For Image URL$root = str_replace(basename($_SERVER['SCRIPT_NAME']), "", $_SERVER['SCRIPT_NAME']);$image_url = $_SERVER['DOCUMENT_ROOT'] . '/';$GLOBALS['image_url'] = $image_url;//echo $GLOBALS['image_url']; exit;class web_api extends model {    function register_member_json() {//  echo "register_member_json";exit;        header('Content-Type: application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;            //echo "<pre>";print_r($postData);exit;        }        if (is_array($postData) && !empty($postData)) {            if (isset($postData['email']) && $postData['email'] != '' && isset($postData['fname']) && $postData['fname'] != '' && isset($postData['city']) && $postData['city'] != '' && isset($postData['phone']) && $postData['phone'] != '' && isset($postData['login_type']) && $postData['login_type'] != '' && isset($postData['otp']) && $postData['otp'] != '' && isset($postData['lat']) && $postData['lat'] != '' && isset($postData['longi']) && $postData['longi'] != '') {                $mobile = $postData['phone'];                $otp = $postData['otp'];                $email = $postData['email'];                $postData['password'] = $this->generateRandomString($length = 6);                $postData['comfirm'] = md5($mobile);                $otp_data = $this->get_OTP($mobile, $otp);                //print_r($otp_data);exit;                if ($otp_data > 0) {                    //print_r($data);exit;                    if ($otp == $otp_data['otp']) {                        //$count = $this->count_userdata($email, $mobile);                        //$countEmail = $this->count_userdataWithEmail($email);                        $countMobile = $this->count_userdataWithMobile($mobile);                        //print_r($count);exit;                        if ($countMobile == 0) {                            $this->update_OTP($otp_data);                            $userdata = $this->register_member_mail($postData);                            if (is_array($userdata) && !empty($userdata)) {                                $data['message'] = "You are successfully registered on Cash Suvidha.";                                $data['userAllDetails'] = $userdata;                                $data['sub_status'] = FALSE;                                $data['success'] = TRUE;                            } else {                                $data['message'] = "Something Went Wrong";                                $data['sub_status'] = FALSE;                                $data['success'] = FALSE;                            }                        } else {                            $data['message'] = "Member already registered with this email/mobile no.";                            $data['sub_status'] = TRUE;                            $data['success'] = FALSE;                        }                    } else {                        $data['message'] = "OTP is incorrect!Please try again.";                        $data['sub_status'] = FALSE;                        $data['success'] = FALSE;                    }                } else {                    $data['message'] = "OTP Not Found!Please try again.";                    $data['sub_status'] = FALSE;                    $data['success'] = FALSE;                }            } else {                $data['message'] = "Parameter Missing";                $data['sub_status'] = FALSE;                $data['success'] = FALSE;            }        } else {            $data['message'] = "Parameter Missing";            $data['sub_status'] = FALSE;            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function register_member_mail($postData) {        $userdata = $this->create_user_json($postData);        $postData['login_type'] = 'normal';        $email = $postData['email'];        $name = $postData['fname'];        $password = $postData['password'];        //Mail to user if user registered as a normal User        if ($postData['login_type'] == 'normal' || $postData['login_type'] == '') {            /* Send  mail to user */            $content = $this->get_content();//      echo "<pre>";print_r($content);exit;            //$subject = str_replace('{site_name}', 'Cash Suvidha', $content->email_subject);            $body = $content->message;            $verify_url = $GLOBALS['base_url'] . '/verification.php?hash=' . $postData['comfirm'];            //$name = " User ";            $body = str_replace('[USER_NAME]', $name, $body);            $body = str_replace('[Email]', $email, $body);            $body = str_replace('[Pass]', $password, $body);            //$body = str_replace('{admin_email}', 'ravikant@web-shuttle.com', $body);            //$body = str_replace('{site_name}', 'Cash Suvidha', $body);            //$body = str_replace('{url}', base_url(), $body);            $body = str_replace('[Begin_Url]', $verify_url, $body);//      echo "<pre>";//      print_r($body);exit;            $mail_conf = array(                'subject' => 'Cash Suvidha',                'to_email' => 'ravikant@web-shuttle.com',                'from_email' => $email,                'from_name' => 'Cash Suvidha',                'body_part' => $body            );            // $this->mailer->sending_mail($mail_conf);        }        /* Send  mail to admin */        $subject = ($postData['login_type'] == 'normal' || $postData['login_type'] == '') ? 'New member is registered' : 'New member is registered with ' . $this->input->get_post('login_type');        $body = '<table border="0" style="width:100%">        <tbody>          <tr><td colspan="2"><strong>Hi Admin,</strong></td></tr>          <tr><td colspan="2">You have new member registered on {site_name} with the following details:</td></tr>          <tr><td colspan="2">&nbsp;</td></tr>          <tr><td><strong>Email ID:</strong></td><td>[Email]</td></tr>          <tr><td><strong>Password:</strong></td><td>[Pass]</td></tr>          <tr><td colspan="2">&nbsp;</td></tr>          <tr><td colspan="2">&nbsp;</td></tr>          <tr>            <td colspan="2">              Thank you.<br />              {site_name} Customer Service<br />              Email: ravikant@web-shuttle.com            </td>          </tr>          <tr>            <td colspan="2" style="text-align:center">              &copy; ' . date('Y') . ' {site_name}. All rights reserved.            </td>          </tr>        </tbody>        </table>';        $body = str_replace('[USER_NAME]', $email, $body);        $body = str_replace('[Email]', 'ravikant@web-shuttle.com', $body);        $body = str_replace('{site_name}', 'Cash Suvidha', $body);        //$body = str_replace('{url}', base_url(), $body);        $mail_conf = array(            'subject' => 'Cash Suvidha',            'to_email' => 'ravikant@web-shuttle.com',            'from_email' => $email,            'from_name' => 'Cash Suvidha',            'body_part' => $body        );        //$this->mailer->sending_mail($mail_conf);        /* End send  mail to admin */        return $userdata;    }    public function sendSms($mobileNumber, $message) {        //Multiple mobiles numbers separated by comma        $mobileNumber = $mobileNumber;        //Sender ID,While using route4 sender id should be 6 characters long.        $senderId = "CASHSU";        $username = "t4cashsuvidha";        $pass = "338574";        //Your message to send, Add URL encoding here.        $message = urlencode($message);        $payload = file_get_contents("http://nimbusit.net/api.php?username=$username&password=$pass&sender=$senderId&sendto=" . $mobileNumber . "&message=" . $message);//    echo $payload;//    exit;    }    public function create_random_n_insert($mobile) {        $otp = rand(100000, 500000);        // $this->session->set_userdata('otp',$otp);        // Insert OTP        $this->insert_otp($mobile, $otp);        //END        $message = "Welcome to CASH SUVIDHA. Your OTP for registration is $otp. This OTP will expire after a minute.";        $this->sendSms($mobile, $message);        return $otp;    }    public function getOTP() {        header('Content-Type:application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        //print_r($postData);exit;        // print_r("here");exit;        if (is_array($postData) && !empty($postData)) {            if (isset($postData['phone']) && $postData['phone'] != '' && isset($postData['otp_for']) && $postData['otp_for'] != "") {                $phone = mysql_real_escape_string($postData['phone']);                $otp_for = mysql_real_escape_string($postData['otp_for']);                if ($otp_for == 'login') {                    //echo "herein_login";exit;                    $check = $this->chk_registered_user($phone);                    if ($check == 0) {                        $data['message'] = "You are not a registered User";                        $data['success'] = FALSE;                    } else {                        $otp = $this->create_random_n_insert($phone);                        $data['otp'] = $otp;                        $data['message'] = "OTP Sent Successfully!";                        $data['success'] = TRUE;                    }                } elseif ($otp_for == 'register') {                    $otp = $this->create_random_n_insert($phone);                    $data['otp'] = $otp;                    $data['message'] = "OTP Sent Successfully!";                    $data['success'] = TRUE;                }            } else {                $data['message'] = "Parameter Missing";                $data['success'] = FALSE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function login_json() {        header('Content-Type:application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents('php://input'));            $postData = (array) $postData;        }        if (is_array($postData) && !empty($postData)) {            if (isset($postData['phone']) && $postData['phone'] != '' && isset($postData['otp']) && $postData['otp'] != '' && isset($postData['lat']) && $postData['lat'] != '' && isset($postData['longi']) && $postData['longi']) {                $mobile = mysql_real_escape_string($postData['phone']);                $otp = mysql_real_escape_string($postData['otp']);                $lat = mysql_real_escape_string($postData['lat']);                $long = mysql_real_escape_string($postData['longi']);                $chk_reg = $this->chk_registered_user($mobile);                $this->update_lat_long($mobile, $lat, $long);                if ($chk_reg > 0) {                    $otp_data = $this->get_OTP($mobile, $otp);                    // print_r($otp_data);exit;                    if ($otp == $otp_data['otp']) {                        //$this->update_OTP($otp_data);                        $userDet = $this->login($mobile);                        //session_start();                        //$_SESSION['user_id'] = $userDet['user_id'];                        //$user_id = $userDet['user_id'];                        //$_SESSION['fname'] = $userDet['fname'];                        //$_SESSION['email'] = $userDet['email'];                        //$_SESSION['phone'] = $userDet['phone'];                        //$_SESSION['city'] = $userDet['city'];                        //print_r($_SESSION);exit;                        $scores = $this->getScores($userDet['user_id']);                        $data['message'] = 'Welcome User!';                        $data['userAllDetails'] = $userDet;                        $data['SocialScore'] = $scores;                        $data['success'] = TRUE;                    } else {                        $data['message'] = 'Incorrect OTP!Please Try again.';                        $data['success'] = FALSE;                    }                } else {                    $data['message'] = "You are not a registered member";                    $data['success'] = FALSE;                }            } else {                $data['message'] = 'Parameter Missing';                $data['success'] = FALSE;            }        } else {            $data['message'] = 'Parameter Missing';            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function user_login() {        if (is_array($_POST) && !empty($_POST)) {            //print_r($_SESSION); exit;            if (isset($_POST['mobile']) && $_POST['mobile'] != '' && isset($_POST['otp']) && $_POST['otp'] != '') {                $mobile = mysql_real_escape_string($_POST['mobile']);                $otp = mysql_real_escape_string($_POST['otp']);                $chk_reg = $this->chk_registered_user($mobile);                if ($chk_reg > 0) {                    $otp_data = $this->get_OTP($mobile, $otp);                    // print_r($otp_data);exit;                    if ($otp == $otp_data['otp']) {                        //$this->update_OTP($otp_data);                        $userDet = $this->login($mobile);                        $loanDet = $this->getloanDets($userDet['user_id']);                        //session_start();                        $_SESSION['user_id'] = $userDet['user_id'];                        $user_id = $userDet['user_id'];                        $_SESSION['fname'] = $userDet['fname'];                        $_SESSION['email'] = $userDet['email'];                        $_SESSION['phone'] = $userDet['phone'];                        $_SESSION['city'] = $userDet['city'];                        $_SESSION['loan_type'] = $loanDet['loan_type'];                        $_SESSION['user_step'] = $loanDet['user_step'];                        $_SESSION['loan_id'] = $loanDet['id'];                        $scores = $this->getScores($userDet['user_id']);                        $_SESSION['message'] = 'Welcome User!';                        $_SESSION['userAllDetails'] = $userDet;                        $_SESSION['SocialScore'] = $scores;                        //print_r($_SESSION); exit;                        header('Location:dashboard.php');                        exit;                    } else {                        $_SESSION['error'] = 'Incorrect OTP!Please Try again.';                        header('Location:' . $_SERVER['HTTP_REFERER']);                        exit;                    }                } else {                    $_SESSION['error'] = "You are not a registered member";                    header('Location:' . $_SERVER['HTTP_REFERER']);                    exit;                    //$data['success'] = FALSE;                }            } else {                $_SESSION['error'] = 'Parameter Missing';                header('Location:' . $_SERVER['HTTP_REFERER']);                exit;            }        }    }    function register_member() {        if (is_array($_POST) && !empty($_POST)) {            if (isset($_POST['email']) && $_POST['email'] != '' && isset($_POST['fname']) && $_POST['fname'] != '' && isset($_POST['city']) && $_POST['city'] != '' && isset($_POST['mobile']) && $_POST['mobile'] != '' && isset($_POST['otp']) && $_POST['otp'] != '') {                $mobile = $_POST['mobile'];                $otp = $_POST['otp'];                $email = $_POST['email'];                $_POST['password'] = $this->generateRandomString($length = 6);                $_POST['comfirm'] = md5($mobile);                $otp_data = $this->get_OTP($mobile, $otp);                //print_r($otp_data);exit;                if ($otp_data > 0) {                    //print_r($data);exit;                    if ($otp == $otp_data['otp']) {                        //$count = $this->count_userdata($email, $mobile);                        //$countEmail = $this->count_userdataWithEmail($email);                        $countMobile = $this->count_userdataWithMobile($mobile);                        //print_r($count);exit;                        if ($countMobile == 0) {                            $this->update_OTP($otp_data);                            $userdata = $this->register_member_mail($_POST);                            if (is_array($userdata) && !empty($userdata)) {                                header('Location:' . $base_url . 'dashboard.php');                                exit;                            } else {                                $_SESSION['error'] = "Something Went Wrong";                                header('Location:' . $_SERVER['HTTP_REFERER']);                            }                        } else {                            $_SESSION['error'] = "Member already registered with this email/mobile no.";                            header('Location:' . $_SERVER['HTTP_REFERER']);                            $data['sub_status'] = TRUE;                            $data['success'] = FALSE;                        }                    } else {                        $_SESSION['error'] = "OTP is incorrect!Please try again.";                        header('Location:' . $_SERVER['HTTP_REFERER']);                        $data['sub_status'] = FALSE;                        $data['success'] = FALSE;                    }                } else {                    $_SESSION['error'] = "OTP Not Found!Please try again.";                    header('Location:' . $_SERVER['HTTP_REFERER']);                    $data['sub_status'] = FALSE;                    $data['success'] = FALSE;                }            } else {                $_SESSION['error'] = "Parameter Missing";                header('Location:' . $_SERVER['HTTP_REFERER']);                $data['sub_status'] = FALSE;                $data['success'] = FALSE;            }        } else {            $_SESSION['error'] = "Parameter Missing";            header('Location:' . $_SERVER['HTTP_REFERER']);            $data['sub_status'] = FALSE;            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function BestLoanOffers() {        $loans = $this->getBestLoans();        if ($loans) {            $data['bestLoans'] = $loans;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found!";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function UploadDocs() {        //echo phpinfo();exit;        //echo $GLOBALS['image_url'];exit;        if (isset($_FILES['customer_pan_image']) && $_FILES['customer_pan_image']['name'] != '' && ($_POST['user_id']) && $_POST['user_id'] > 0) {            $file_name = $_FILES['customer_pan_image']['name'];            $file_tmp_name = $_FILES['customer_pan_image']['tmp_name'];            $file_type = $_FILES['customer_pan_image']['type'];            $file_size = $_FILES['customer_pan_image']['size'];            $file_error = $_FILES['customer_pan_image']['error'];            $cust_id = $_POST['user_id'];            $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);            if ($uploaded_file != NULL) {                $this->uploadPAN($uploaded_file, $cust_id);                $data['message'] = "Image Uploaded Successfully";                $data['success'] = TRUE;            } else {                $data['message'] = "Can't Customer PAN Card";                $data['success'] = FALSE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function check_n_move_file($file_tmp_name, $file_name) {        $check = TRUE;        $cntr = 1;        $orig_name = $file_name;        do {            if (file_exists($GLOBALS['image_url'] . 'uploads/' . $file_name)) {                $file_name = $cntr . '_' . $orig_name;                ++$cntr;            } else {                $file_name = $file_name;                $check = FALSE;            }        } while ($check == TRUE);        $uploaded_file = move_uploaded_file($file_tmp_name, $GLOBALS['image_url'] . 'uploads/' . $file_name);        if ($uploaded_file == TRUE) {            return $file_name;        } else {            return 0;        }    }    //Vicky    public function uploadDocweb() {        //print_r($_POST); exit;        if (isset($_POST['loan_type']) && $_POST['loan_type'] > 0) {            $postData['cust_id'] = mysql_real_escape_string($_SESSION['user_id']);            $postData['cust_pan_no'] = mysql_real_escape_string($_POST['userPenCard']);            $postData['cust_aadhar_no'] = mysql_real_escape_string($_POST['userAddharCard']);            $postData['userEmail'] = mysql_real_escape_string($_SESSION['email']);            $postData['loan_type'] = mysql_real_escape_string($_POST['loan_type']);            //Insert into table            $insert_data = $this->update_user_loan($postData);            //echo $insert_data;            //exit;            //upload pan card and adhar card            if (isset($_FILES['customer_pan_image']) && $_FILES['customer_pan_image']['name'] != '') {                $file_name = $_FILES['customer_pan_image']['name'];                $file_tmp_name = $_FILES['customer_pan_image']['tmp_name'];                $file_type = $_FILES['customer_pan_image']['type'];                $file_size = $_FILES['customer_pan_image']['size'];                $file_error = $_FILES['customer_pan_image']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                //echo $uploaded_file; exit;                if ($uploaded_file != NULL) {                    $this->uploadPAN($uploaded_file, $postData['cust_id']);                    $data['Customer_pan_message'] = "Customer PAN Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Customer_pan_message'] = "Can't Upload Customer PAN Card";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['aadhar_card']) && $_FILES['aadhar_card']['name'] != '') {                $file_name = $_FILES['aadhar_card']['name'];                $file_tmp_name = $_FILES['aadhar_card']['tmp_name'];                $file_type = $_FILES['aadhar_card']['type'];                $file_size = $_FILES['aadhar_card']['size'];                $file_error = $_FILES['aadhar_card']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->updateAdhar($uploaded_file, $postData['cust_id']);                    $data['Address_message'] = "Adhar Proof updated Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Address_message'] = "Can't Upload Address Proof";                    $data['success'] = FALSE;                }            }            header('Location:cashScoreWeb.php');        } else {            $_SESSION['error'] = "Something went wrong, please try again.";            header('Location:' . $_SERVER['HTTP_REFERER']);            exit;        }    }    public function save_personal_info_web() {        if (isset($_POST['gender']) && isset($_POST['userCompleteResAddress'])) {            $this->save_personal_web();            header('Location:general_info.php');        } else {            $_SESSION['error'] = "Something went wrong, please try again.";            header('Location:' . $_SERVER['HTTP_REFERER']);            exit;        }    }    public function save_genral_info_web() {        if (isset($_POST['loan_type']) && isset($_POST['loan_amount'])) {            $this->save_gernal_web();            $_SESSION['loan_type'] = $_POST['loan_type'];            if ($_SESSION['loan_type'] == 1) {                header('Location:employer_info.php');            } else {                header('Location:business_info.php');            }        } else {            $_SESSION['error'] = "Something went wrong, please try again.";            header('Location:' . $_SERVER['HTTP_REFERER']);            exit;        }    }    public function save_business_info_web() {        if (isset($_POST['business_pan_no']) && isset($_POST['reg_address'])) {            $this->save_business_web();            header('Location:upload_doc_business.php');        } else {            $_SESSION['error'] = "Something went wrong, please try again.";            header('Location:' . $_SERVER['HTTP_REFERER']);            exit;        }    }    public function save_business_doc_web() {        if (isset($_POST)) {            if (isset($_FILES['ITR']) && $_FILES['ITR']['name'] != '') {                $file_name = $_FILES['ITR']['name'];                $file_tmp_name = $_FILES['ITR']['tmp_name'];                $file_type = $_FILES['ITR']['type'];                $file_size = $_FILES['ITR']['size'];                $file_error = $_FILES['ITR']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadITR($uploaded_file, $postData['cust_id']);                    $data['ITR_message'] = "ITR Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['ITR_message'] = "Can't Upload ITR Card";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['balance_sheet']) && $_FILES['balance_sheet']['name'] != '') {                $file_name = $_FILES['balance_sheet']['name'];                $file_tmp_name = $_FILES['balance_sheet']['tmp_name'];                $file_type = $_FILES['balance_sheet']['type'];                $file_size = $_FILES['balance_sheet']['size'];                $file_error = $_FILES['balance_sheet']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadBalanceSheet($uploaded_file, $postData['cust_id']);                    $data['BalanceSheet_message'] = "Balance Sheet uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['BalanceSheet_message'] = "Can't Upload Balance Sheet";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['PL']) && $_FILES['PL']['name'] != '') {                $check = TRUE;                $file_name = $_FILES['PL']['name'];                $file_tmp_name = $_FILES['PL']['tmp_name'];                $file_type = $_FILES['PL']['type'];                $file_size = $_FILES['PL']['size'];                $file_error = $_FILES['PL']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadPL($uploaded_file, $postData['cust_id']);                    $data['PL_message'] = "PL Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['PL_message'] = "Can't Upload PL";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['computation_image']) && $_FILES['computation_image']['name'] != '') {                $file_name = $_FILES['computation_image']['name'];                $file_tmp_name = $_FILES['computation_image']['tmp_name'];                $file_type = $_FILES['computation_image']['type'];                $file_size = $_FILES['computation_image']['size'];                $file_error = $_FILES['computation_image']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadComputation($uploaded_file, $postData['cust_id']);                    $data['computation_message'] = "Computation Image Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['computation_message'] = "Can't Upload Computation";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['bank_image']) && $_FILES['bank_image']['name'] != '') {                $file_name = $_FILES['bank_image']['name'];                $file_tmp_name = $_FILES['bank_image']['tmp_name'];                $file_type = $_FILES['bank_image']['type'];                $file_size = $_FILES['bank_image']['size'];                $file_error = $_FILES['bank_image']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadBusBank($uploaded_file, $postData['cust_id']);                    $data['Bank_Statement'] = "Bank Statement Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Bank_Statement'] = "Can't Upload Bank Statement";                    $data['success'] = FALSE;                }            }            $this->update_user_step();            $_SESSION['user_step'] = 0;            header('Location:' . $base_url . 'dashboard.php');            exit;        } else {            $_SESSION['error'] = "Something went wrong, please try again.";            header('Location:' . $_SERVER['HTTP_REFERER']);            exit;        }    }    public function save_employer_info_web() {        if (isset($_POST['org_name']) && isset($_POST['monthly_income'])) {            $this->save_employer_web();            header('Location:upload_doc.php');        } else {            $_SESSION['error'] = "Something went wrong, please try again.";            header('Location:' . $_SERVER['HTTP_REFERER']);            exit;        }    }    public function save_upload_doc() {        if (isset($_POST)) {            if (isset($_FILES['customer_pan_image']) && $_FILES['customer_pan_image']['name'] != '') {                $file_name = $_FILES['customer_pan_image']['name'];                $file_tmp_name = $_FILES['customer_pan_image']['tmp_name'];                $file_type = $_FILES['customer_pan_image']['type'];                $file_size = $_FILES['customer_pan_image']['size'];                $file_error = $_FILES['customer_pan_image']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadPAN($uploaded_file, $postData['cust_id']);                    $data['Customer_pan_message'] = "Customer PAN Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Customer_pan_message'] = "Can't Upload Customer PAN Card";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['address_image']) && $_FILES['address_image']['name'] != '') {                $file_name = $_FILES['address_image']['name'];                $file_tmp_name = $_FILES['address_image']['tmp_name'];                $file_type = $_FILES['address_image']['type'];                $file_size = $_FILES['address_image']['size'];                $file_error = $_FILES['address_image']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadAddress($uploaded_file, $postData['cust_id']);                    $data['Address_message'] = "Address Proof uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Address_message'] = "Can't Upload Address Proof";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['electricity_bill']) && $_FILES['electricity_bill']['name'] != '') {                $check = TRUE;                $file_name = $_FILES['electricity_bill']['name'];                $file_tmp_name = $_FILES['electricity_bill']['tmp_name'];                $file_type = $_FILES['electricity_bill']['type'];                $file_size = $_FILES['electricity_bill']['size'];                $file_error = $_FILES['electricity_bill']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadElecBill($uploaded_file, $postData['cust_id']);                    $data['Electricity_message'] = "Electricity Bill Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Electricity_message'] = "Can't Upload Electricity Bill";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['salary_slip']) && $_FILES['salary_slip']['name'] != '') {                $file_name = $_FILES['salary_slip']['name'];                $file_tmp_name = $_FILES['salary_slip']['tmp_name'];                $file_type = $_FILES['salary_slip']['type'];                $file_size = $_FILES['salary_slip']['size'];                $file_error = $_FILES['salary_slip']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadSalary($uploaded_file, $postData['cust_id']);                    $data['Salary_slip'] = "Salary Slip Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Salary_slip'] = "Can't Upload Salary Slip";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['rental_agreement']) && $_FILES['rental_agreement']['name'] != '') {                $file_name = $_FILES['rental_agreement']['name'];                $file_tmp_name = $_FILES['rental_agreement']['tmp_name'];                $file_type = $_FILES['rental_agreement']['type'];                $file_size = $_FILES['rental_agreement']['size'];                $file_error = $_FILES['rental_agreement']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadRental($uploaded_file, $postData['cust_id']);                    $data['Rental_message'] = "Rental Agreement Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Rental_message'] = "Can't Upload Rental Agreement";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['TTR']) && $_FILES['TTR']['name'] != '') {                $file_name = $_FILES['TTR']['name'];                $file_tmp_name = $_FILES['TTR']['tmp_name'];                $file_type = $_FILES['TTR']['type'];                $file_size = $_FILES['TTR']['size'];                $file_error = $_FILES['TTR']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadTTR($uploaded_file, $postData['cust_id']);                    $data['TTR_message'] = "TTR Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['TTR_message'] = "Can't Upload TTR";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['Form16']) && $_FILES['Form16']['name'] != '') {                $file_name = $_FILES['Form16']['name'];                $file_tmp_name = $_FILES['Form16']['tmp_name'];                $file_type = $_FILES['Form16']['type'];                $file_size = $_FILES['Form16']['size'];                $file_error = $_FILES['Form16']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadForm16($uploaded_file, $postData['cust_id']);                    $data['Form_16_message'] = "Form 16 Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Form_16_message'] = "Can't Upload Form 16";                    $data['success'] = FALSE;                }            }            if (isset($_FILES['bank_statement']) && $_FILES['bank_statement']['name'] != '') {                $file_name = $_FILES['bank_statement']['name'];                $file_tmp_name = $_FILES['bank_statement']['tmp_name'];                $file_type = $_FILES['bank_statement']['type'];                $file_size = $_FILES['bank_statement']['size'];                $file_error = $_FILES['bank_statement']['error'];                $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                if ($uploaded_file != NULL) {                    $this->uploadBankState($uploaded_file, $postData['cust_id']);                    $data['Bank_Statement_message'] = "Bank Statement Uploaded Successfully!";                    $data['success'] = TRUE;                } else {                    $data['Bank_Statement_message'] = "Can't Upload Bank Statement";                    $data['success'] = FALSE;                }            }            $this->update_user_step();            header('Location:' . $base_url . 'dashboard.php');            exit;        } else {            $_SESSION['error'] = "Something went wrong, please try again.";            header('Location:' . $_SERVER['HTTP_REFERER']);            exit;        }    }    //End    public function UploadDocument() {        //print_r($_POST);        if (isset($_POST['loan_type']) && $_POST['loan_type'] == 1) {            // echo "here in loan type 1";exit;            if (isset($_POST['custId']) && $_POST['custId'] != "" && isset($_POST['userPenCard']) && $_POST['userPenCard'] != "" && isset($_POST['userAddharCard']) && $_POST['userAddharCard'] != "" && isset($_POST['userName']) && $_POST['userName'] != "" && isset($_POST['userGender']) && $_POST['userGender'] != "" && isset($_POST['userDOB']) && $_POST['userDOB'] != "" && isset($_POST['userEmail']) && $_POST['userEmail'] != "" && isset($_POST['userCompleteResAddress']) && $_POST['userCompleteResAddress'] != "" && isset($_POST['userCompletePerAddress']) && $_POST['userCompletePerAddress'] != "" && isset($_POST['loan_amount']) && $_POST['loan_amount'] != "" && isset($_POST['organisation_name']) && $_POST['organisation_name'] != "" && isset($_POST['designation']) && $_POST['designation'] != "" && isset($_POST['office_add']) && $_POST['office_add'] != "" && isset($_POST['no_of_year']) && $_POST['no_of_year'] != "" && isset($_POST['total_exp']) && $_POST['total_exp'] != "" && isset($_POST['monthly_income']) && $_POST['monthly_income'] != "" && isset($_POST['lat']) && $_POST['lat'] != '' && isset($_POST['longi']) && $_POST['longi']) {                //print_r($_POST);exit;                $postData['cust_id'] = mysql_real_escape_string($_POST['custId']);                $postData['cust_pan_no'] = mysql_real_escape_string($_POST['userPenCard']);                $postData['cust_aadhar_no'] = mysql_real_escape_string($_POST['userAddharCard']);                $postData['userName'] = mysql_real_escape_string($_POST['userName']);                $postData['userGender'] = mysql_real_escape_string($_POST['userGender']);                $postData['userDOB'] = mysql_real_escape_string($_POST['userDOB']);                $postData['userEmail'] = mysql_real_escape_string($_POST['userEmail']);                $postData['userCompleteResAddress'] = mysql_real_escape_string($_POST['userCompleteResAddress']);                $postData['userCompletePerAddress'] = mysql_real_escape_string($_POST['userCompletePerAddress']);                //$postData['date'] = mysql_real_escape_string($_POST['date']);                $postData['loan_amount'] = mysql_real_escape_string($_POST['loan_amount']);                $postData['loan_type'] = mysql_real_escape_string($_POST['loan_type']);                $postData['organisation_name'] = mysql_real_escape_string($_POST['organisation_name']);                $postData['designation'] = mysql_real_escape_string($_POST['designation']);                $postData['office_add'] = mysql_real_escape_string($_POST['office_add']);                $postData['no_of_year'] = mysql_real_escape_string($_POST['no_of_year']);                $postData['total_exp'] = mysql_real_escape_string($_POST['total_exp']);                $postData['monthly_income'] = mysql_real_escape_string($_POST['monthly_income']);                $postData['lat'] = mysql_real_escape_string($_POST['lat']);                $postData['longi'] = mysql_real_escape_string($_POST['longi']);                $check = 0; //$this->check_user_with_loan_type($postData['cust_id'], $postData['loan_type']);                $this->updateLatLong($postData['cust_id'], $postData['lat'], $postData['longi']);                //print_r($check);exit;                //print_r($_POST);exit;                // print_r($_FILES);exit;                if ($check == 0) {                    $insert_data = $this->manage_users_personal($postData);                    if ($insert_data == TRUE) {                        $data['message'] = "Loan Request Received!";                        $data['success'] = TRUE;                    } else {                        $data['message'] = "Something Went Wrong!";                        $data['success'] = FALSE;                    }                    if (isset($_FILES['customer_pan_image']) && $_FILES['customer_pan_image']['name'] != '') {                        $file_name = $_FILES['customer_pan_image']['name'];                        $file_tmp_name = $_FILES['customer_pan_image']['tmp_name'];                        $file_type = $_FILES['customer_pan_image']['type'];                        $file_size = $_FILES['customer_pan_image']['size'];                        $file_error = $_FILES['customer_pan_image']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadPAN($uploaded_file, $postData['cust_id']);                            $data['Customer_pan_message'] = "Customer PAN Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Customer_pan_message'] = "Can't Upload Customer PAN Card";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['address_image']) && $_FILES['address_image']['name'] != '') {                        $file_name = $_FILES['address_image']['name'];                        $file_tmp_name = $_FILES['address_image']['tmp_name'];                        $file_type = $_FILES['address_image']['type'];                        $file_size = $_FILES['address_image']['size'];                        $file_error = $_FILES['address_image']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadAddress($uploaded_file, $postData['cust_id']);                            $data['Address_message'] = "Address Proof uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Address_message'] = "Can't Upload Address Proof";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['electricity_bill']) && $_FILES['electricity_bill']['name'] != '') {                        $check = TRUE;                        $file_name = $_FILES['electricity_bill']['name'];                        $file_tmp_name = $_FILES['electricity_bill']['tmp_name'];                        $file_type = $_FILES['electricity_bill']['type'];                        $file_size = $_FILES['electricity_bill']['size'];                        $file_error = $_FILES['electricity_bill']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadElecBill($uploaded_file, $postData['cust_id']);                            $data['Electricity_message'] = "Electricity Bill Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Electricity_message'] = "Can't Upload Electricity Bill";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['salary_slip']) && $_FILES['salary_slip']['name'] != '') {                        $file_name = $_FILES['salary_slip']['name'];                        $file_tmp_name = $_FILES['salary_slip']['tmp_name'];                        $file_type = $_FILES['salary_slip']['type'];                        $file_size = $_FILES['salary_slip']['size'];                        $file_error = $_FILES['salary_slip']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadSalary($uploaded_file, $postData['cust_id']);                            $data['Salary_slip'] = "Salary Slip Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Salary_slip'] = "Can't Upload Salary Slip";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['rental_agreement']) && $_FILES['rental_agreement']['name'] != '') {                        $file_name = $_FILES['rental_agreement']['name'];                        $file_tmp_name = $_FILES['rental_agreement']['tmp_name'];                        $file_type = $_FILES['rental_agreement']['type'];                        $file_size = $_FILES['rental_agreement']['size'];                        $file_error = $_FILES['rental_agreement']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadRental($uploaded_file, $postData['cust_id']);                            $data['Rental_message'] = "Rental Agreement Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Rental_message'] = "Can't Upload Rental Agreement";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['TTR']) && $_FILES['TTR']['name'] != '') {                        $file_name = $_FILES['TTR']['name'];                        $file_tmp_name = $_FILES['TTR']['tmp_name'];                        $file_type = $_FILES['TTR']['type'];                        $file_size = $_FILES['TTR']['size'];                        $file_error = $_FILES['TTR']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadTTR($uploaded_file, $postData['cust_id']);                            $data['TTR_message'] = "TTR Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['TTR_message'] = "Can't Upload TTR";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['Form16']) && $_FILES['Form16']['name'] != '') {                        $file_name = $_FILES['Form16']['name'];                        $file_tmp_name = $_FILES['Form16']['tmp_name'];                        $file_type = $_FILES['Form16']['type'];                        $file_size = $_FILES['Form16']['size'];                        $file_error = $_FILES['Form16']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadForm16($uploaded_file, $postData['cust_id']);                            $data['Form_16_message'] = "Form 16 Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Form_16_message'] = "Can't Upload Form 16";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['bank_statement']) && $_FILES['bank_statement']['name'] != '') {                        $file_name = $_FILES['bank_statement']['name'];                        $file_tmp_name = $_FILES['bank_statement']['tmp_name'];                        $file_type = $_FILES['bank_statement']['type'];                        $file_size = $_FILES['bank_statement']['size'];                        $file_error = $_FILES['bank_statement']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadBankState($uploaded_file, $postData['cust_id']);                            $data['Bank_Statement_message'] = "Bank Statement Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Bank_Statement_message'] = "Can't Upload Bank Statement";                            $data['success'] = FALSE;                        }                    }                } else {                    $data['message'] = "User Already exist with this loan";                    $data['success'] = FALSE;                }            } else {                $data['message'] = "Parameter Missing";                $data['success'] = FALSE;            }        } elseif (isset($_POST['loan_type']) && $_POST['loan_type'] == 2) {            if (isset($_POST['custId']) && $_POST['custId'] != "" && isset($_POST['userPenCard']) && $_POST['userPenCard'] != "" && isset($_POST['userAddharCard']) && $_POST['userAddharCard'] != "" && isset($_POST['userName']) && $_POST['userName'] != "" && isset($_POST['userGender']) && $_POST['userGender'] != "" && isset($_POST['userDOB']) && $_POST['userDOB'] != "" && isset($_POST['userEmail']) && $_POST['userEmail'] != "" && isset($_POST['userCompleteResAddress']) && $_POST['userCompleteResAddress'] != "" && isset($_POST['userCompletePerAddress']) && $_POST['userCompletePerAddress'] != "" && isset($_POST['loan_amount']) && $_POST['loan_amount'] != "" && isset($_POST['business_pan_no']) && $_POST['business_pan_no'] != "" && isset($_POST['entity_type']) && $_POST['entity_type'] != "" && isset($_POST['business_turnover']) && $_POST['business_turnover'] != "" && isset($_POST['business_entity_name']) && $_POST['business_entity_name'] != "" && isset($_POST['business_address']) && $_POST['business_address'] != "" && isset($_POST['reg_address']) && $_POST['reg_address'] != "" && isset($_POST['lat']) && $_POST['lat'] != '' && isset($_POST['longi']) && $_POST['longi'] != '') {                $postData['cust_id'] = mysql_real_escape_string($_POST['custId']);                $postData['cust_pan_no'] = mysql_real_escape_string($_POST['userPenCard']);                $postData['cust_aadhar_no'] = mysql_real_escape_string($_POST['userAddharCard']);                $postData['userName'] = mysql_real_escape_string($_POST['userName']);                $postData['userGender'] = mysql_real_escape_string($_POST['userGender']);                $postData['userDOB'] = mysql_real_escape_string($_POST['userDOB']);                $postData['userEmail'] = mysql_real_escape_string($_POST['userEmail']);                $postData['userCompleteResAddress'] = mysql_real_escape_string($_POST['userCompleteResAddress']);                $postData['userCompletePerAddress'] = mysql_real_escape_string($_POST['userCompletePerAddress']);                //$postData['date'] = mysql_real_escape_string($_POST['date']);                $postData['loan_amount'] = mysql_real_escape_string($_POST['loan_amount']);                $postData['loan_type'] = mysql_real_escape_string($_POST['loan_type']);                $postData['business_pan_no'] = mysql_real_escape_string($_POST['business_pan_no']);                $postData['entity_type'] = mysql_real_escape_string($_POST['entity_type']);                $postData['business_turnover'] = mysql_real_escape_string($_POST['business_turnover']);                $postData['business_entity_name'] = mysql_real_escape_string($_POST['business_entity_name']);                $postData['business_address'] = mysql_real_escape_string($_POST['business_address']);                $postData['reg_address'] = mysql_real_escape_string($_POST['reg_address']);                $postData['lat'] = mysql_real_escape_string($_POST['lat']);                $postData['longi'] = mysql_real_escape_string($_POST['longi']);                $this->updateLatLong($postData['cust_id'], $postData['lat'], $postData['longi']);                $check = 0; //$this->check_user_with_loan_type($postData['cust_id'], $postData['loan_type']);                if ($check == 0) {                    $insert_data = $this->manage_users_business($postData);                    if ($insert_data == TRUE) {                        $data['message'] = "Loan Request Received!";                        $data['success'] = TRUE;                    } else {                        $data['message'] = "Something Went Wrong!";                        $data['success'] = FALSE;                    }                    if (isset($_FILES['ITR']) && $_FILES['ITR']['name'] != '') {                        $file_name = $_FILES['ITR']['name'];                        $file_tmp_name = $_FILES['ITR']['tmp_name'];                        $file_type = $_FILES['ITR']['type'];                        $file_size = $_FILES['ITR']['size'];                        $file_error = $_FILES['ITR']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadITR($uploaded_file, $postData['cust_id']);                            $data['ITR_message'] = "ITR Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['ITR_message'] = "Can't Upload ITR Card";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['balance_sheet']) && $_FILES['balance_sheet']['name'] != '') {                        $file_name = $_FILES['balance_sheet']['name'];                        $file_tmp_name = $_FILES['balance_sheet']['tmp_name'];                        $file_type = $_FILES['balance_sheet']['type'];                        $file_size = $_FILES['balance_sheet']['size'];                        $file_error = $_FILES['balance_sheet']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadBalanceSheet($uploaded_file, $postData['cust_id']);                            $data['BalanceSheet_message'] = "Balance Sheet uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['BalanceSheet_message'] = "Can't Upload Balance Sheet";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['PL']) && $_FILES['PL']['name'] != '') {                        $check = TRUE;                        $file_name = $_FILES['PL']['name'];                        $file_tmp_name = $_FILES['PL']['tmp_name'];                        $file_type = $_FILES['PL']['type'];                        $file_size = $_FILES['PL']['size'];                        $file_error = $_FILES['PL']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadPL($uploaded_file, $postData['cust_id']);                            $data['PL_message'] = "PL Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['PL_message'] = "Can't Upload PL";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['computation_image']) && $_FILES['computation_image']['name'] != '') {                        $file_name = $_FILES['computation_image']['name'];                        $file_tmp_name = $_FILES['computation_image']['tmp_name'];                        $file_type = $_FILES['computation_image']['type'];                        $file_size = $_FILES['computation_image']['size'];                        $file_error = $_FILES['computation_image']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadComputation($uploaded_file, $postData['cust_id']);                            $data['computation_message'] = "Computation Image Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['computation_message'] = "Can't Upload Computation";                            $data['success'] = FALSE;                        }                    }                    if (isset($_FILES['bank_image']) && $_FILES['bank_image']['name'] != '') {                        $file_name = $_FILES['bank_image']['name'];                        $file_tmp_name = $_FILES['bank_image']['tmp_name'];                        $file_type = $_FILES['bank_image']['type'];                        $file_size = $_FILES['bank_image']['size'];                        $file_error = $_FILES['bank_image']['error'];                        $uploaded_file = $this->check_n_move_file($file_tmp_name, $file_name);                        if ($uploaded_file != NULL) {                            $this->uploadBusBank($uploaded_file, $postData['cust_id']);                            $data['Bank_Statement'] = "Bank Statement Uploaded Successfully!";                            $data['success'] = TRUE;                        } else {                            $data['Bank_Statement'] = "Can't Upload Bank Statement";                            $data['success'] = FALSE;                        }                    }                } else {                    $data['message'] = "User already exist with this loan";                    $data['success'] = FALSE;                }            } else {                $data['message'] = "Parameter Missing";                $data['success'] = FALSE;            }        } else {            $data['message'] = "Loan Type is Missing";            $data['success'] = FALSE;        }        //print_r($data);exit;        echo json_encode($data);    }    public function getCities() {        // echo "here";exit;        $Cities = $this->get_Cities();        if ($Cities != NULL) {            $data['cities'] = $Cities;            $data['success'] = TRUE;        } else {            $data['message'] = "No records Found!";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function generateRandomString($length = 10) {        $characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';        $charactersLength = strlen($characters);        $randomString = '';        for ($i = 0; $i < $length; $i++) {            $randomString .= $characters[rand(0, $charactersLength - 1)];        }        return $randomString;    }    public function getMonthlyIncome() {        $Income = $this->GetMonthly_Income();//        print_r($Income);exit;        if ($Income != NULL) {            $data['income'] = $Income;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getTotalExp() {        $Exp = $this->getTotal_Exp();//        print_r($Income);exit;        if ($Exp != NULL) {            $data['experience'] = $Exp;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getTurnover() {        $Turnover = $this->get_Turnover();//        print_r($Income);exit;        if ($Turnover != NULL) {            $data['turnover'] = $Turnover;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getEntities() {        $Entities = $this->get_Entities();//        print_r($Income);exit;        if ($Entities != NULL) {            $data['Entities'] = $Entities;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getCurrentEmpYear() {        $CurrentYear = $this->get_CurrentEmpYear();//        print_r($Income);exit;        if ($CurrentYear != NULL) {            $data['CurrentYear'] = $CurrentYear;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getLoanType() {        // echo "here";exit;        header("Content-Type:application/json");        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        if (isset($postData['cust_id']) && $postData['cust_id'] != "") {            $cust_id = mysql_real_escape_string($postData['cust_id']);            $LoanType = $this->get_LoanType($cust_id);            if ($LoanType != NULL) {                $data['LoanType'] = $LoanType;                $data['success'] = TRUE;            } else {                $data['message'] = "No Records Found";                $data['success'] = FALSE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getCompanyProfilePayYou() {        header('Content-Type:application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        if (is_array($postData) && !empty($postData)) {            if (isset($postData['ca_id']) && $postData['ca_id'] > 0 && isset($postData['loan_request_number']) && $postData['loan_request_number'] != "" && isset($postData['personal_email']) && $postData['personal_email'] != "" && isset($postData['biz_address']) && $postData['biz_address'] != "" && isset($postData['vintage']) && $postData['vintage'] > 0 && isset($postData['operating_since']) && $postData['operating_since'] != "" && isset($postData['vintage_total']) && $postData['vintage_total'] > 0 && isset($postData['biz_pincode']) && $postData['biz_pincode'] > 0 && isset($postData['incorporation_date']) && $postData['incorporation_date'] != "" && isset($postData['biz_contact_no']) && $postData['biz_contact_no'] > 0 && isset($postData['biz_pan']) && $postData['biz_pan'] != "" && isset($postData['sme_display_name']) && $postData['sme_display_name'] != "" && isset($postData['type_of_business']) && $postData['type_of_business'] != "" && isset($postData['vat_tin']) && $postData['vat_tin'] != "" && isset($postData['business_city']) && $postData['business_city'] != "" && isset($postData['mobile']) && $postData['mobile'] != "" && isset($postData['partner_type']) && $postData['partner_type'] != "" && isset($postData['nature_of_business']) && $postData['nature_of_business'] != "" && isset($postData['sme_bank_acc_no']) && $postData['sme_bank_acc_no'] != "" && isset($postData['biz_kyc_doc']) && $postData['biz_kyc_doc'] && isset($postData['in_principal_approval_callback_url'][0]) && $postData['in_principal_approval_callback_url'][0] != "" && isset($postData['post_approval_callback_url'][0]) && $postData['post_approval_callback_url'][0] != "" && isset($postData['disbursement_details'][0]) && $postData['disbursement_details'][0] != "" && isset($postData['applicants'][0]->city_key) && $postData['applicants'][0]->city_key != "" && isset($postData['applicants'][0]->personal_email) && $postData['applicants'][0]->personal_email != "" && isset($postData['applicants'][0]->mobile) && $postData['applicants'][0]->mobile != "" && isset($postData['applicants'][0]->pincode_key) && $postData['applicants'][0]->pincode_key != "" && isset($postData['applicants'][0]->pan_no) && $postData['applicants'][0]->pan_no != "" && isset($postData['applicants'][0]->state_key) && $postData['applicants'][0]->state_key != "" && isset($postData['applicants'][0]->res_address_partner) && $postData['applicants'][0]->res_address_partner != "" && isset($postData['applicants'][0]->ownership_partner) && $postData['applicants'][0]->ownership_partner != "" && isset($postData['applicants'][0]->dob) && $postData['applicants'][0]->dob != "" && isset($postData['applicants'][0]->applicant_name) && $postData['applicants'][0]->applicant_name != "" && isset($postData['applicants'][0]->aadhaar_id) && $postData['applicants'][0]->aadhaar_id != "") {                $check = $this->get_payu_applicant($postData['applicants'][0]->personal_email, $postData['applicants'][0]->mobile);                if ($check == 0) {                    $this->manage_payu_data($postData);                    $city_exists = $this->city_exists($postData['applicants'][0]->city_key);                    if (is_array($city_exists) && !empty($city_exists)) {                        $postData['applicants'][0]->city_id = $city_exists['id'];                    } else {                        $city = $this->add_new_city($postData['applicants'][0]->city_key);                        $postData['applicants'][0]->city_id = $city['id'];                    }                    $applicant_data = $this->manage_payu_applicant_data($postData['applicants'][0]);                    $this->manage_last_tweleve_months_payment_sale($postData['last_12_months_payment_sale'], $applicant_data['user_id']);                    $data['appraisal_in_process'] = true;                    $data['in_principal_approval'] = false;                    $data['amount_sanctioned'] = "";                    $data['reason'] = "Appraisal In Process";                    $data['interest'] = "";                    $data['duration'] = "";                    $data['loan_request_number'] = $postData['loan_request_number'];                } else {                    $data['message'] = "User already registered with this email and phone number.";                    $data['success'] = FALSE;                }            } else {                $data['message'] = "Parameter Missing";                $data['success'] = FALSE;            }//                          } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getAllStatic() {        //For Current Year        $CurrentYear = $this->get_CurrentEmpYear();        //For Income        $Income = $this->GetMonthly_Income();        // For Exp        $Exp = $this->getTotal_Exp();        // For TurnOver        $Turnover = $this->get_Turnover();        //For Entities        $Entities = $this->get_Entities();        if ($CurrentYear != NULL) {            $data['CurrentYear'] = $CurrentYear;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        if ($Income != NULL) {            $data['Income'] = $Income;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        if ($Exp != NULL) {            $data['Experience'] = $Exp;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        if ($Turnover != NULL) {            $data['Turnover'] = $Turnover;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        if ($Entities != NULL) {            $data['Entities'] = $Entities;            $data['success'] = TRUE;        } else {            $data['message'] = "No Records Found";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function SocialScore() {        header("Content-Type:application/json");        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents('php://input'));            $postData = (array) $postData;        }        if (is_array($postData) && !empty($postData)) {            if (isset($postData['custId']) && $postData['custId'] > 0 && isset($postData['score_for']) && $postData['score_for'] != '' && isset($postData['score']) && $postData['score'] != '') {                $data['social_score'] = $this->getSocialScore($postData);                $data['success'] = TRUE;            } else {                $data['message'] = "Something Went Wrong";                $data['success'] = FALSE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getSMS() {        header('Content-Type:application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        //print_r($postData);exit;        if (isset($postData['custId']) && $postData['custId'] != '' && isset($postData['SMS'][0]->message) && $postData['SMS'][0]->message && isset($postData['SMS'][0]->ContactNo) && $postData['SMS'][0]->ContactNo && isset($postData['SMS'][0]->Time) && $postData['SMS'][0]->Time        ) {            foreach ($postData['SMS'] as $sms) {                $res = $this->insertSMS($sms, $postData['custId']);            }            if ($res > 0) {                $data['message'] = "Admin will recieve your SMS shortly";                $data['success'] = TRUE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getContacts() {        header('Content-Type:application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        if (isset($postData['custId']) && $postData['custId'] != '' && isset($postData['Contact'][0]->ContactNo) && $postData['Contact'][0]->ContactNo && isset($postData['Contact'][0]->ContactName) && $postData['Contact'][0]->ContactName) {            foreach ($postData['Contact'] as $Contact) {                $res = $this->insertContact($Contact, $postData['custId']);            }            if ($res > 0) {                $data['message'] = "Admin will recieve your Contacts shortly";                $data['success'] = TRUE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getCallHistory() {        header('Content-Type:application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        if (isset($postData['custId']) && $postData['custId'] != '' && isset($postData['CallHistory'][0]->ContactNo) && $postData['CallHistory'][0]->Time && isset($postData['CallHistory'][0]->DeviceId) && $postData['CallHistory'][0]->DeviceId) {            foreach ($postData['CallHistory'] as $calHis) {                $res = $this->insertCallHistory($calHis, $postData['custId']);            }            if ($res > 0) {                $data['message'] = "Admin will recieve your CallHistory shortly";                $data['success'] = TRUE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function getDeviceInfo() {        header('Content-Type:application/json');        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        if (isset($postData['DeviceInfo'][0]->custId) && $postData['DeviceInfo'][0]->custId != '' && isset($postData['DeviceInfo'][0]->serialno) && $postData['DeviceInfo'][0]->serialno != '' && isset($postData['DeviceInfo'][0]->modelno) && $postData['DeviceInfo'][0]->modelno != '' && isset($postData['DeviceInfo'][0]->deviceid) && $postData['DeviceInfo'][0]->deviceid != '' && isset($postData['DeviceInfo'][0]->manufacturer) && $postData['DeviceInfo'][0]->manufacturer != '' && isset($postData['DeviceInfo'][0]->versioncode) && $postData['DeviceInfo'][0]->versioncode != '' && isset($postData['DeviceInfo'][0]->IMEI) && $postData['DeviceInfo'][0]->IMEI != '') {            foreach ($postData['DeviceInfo'] as $DevInfo) {                $res = $this->insertDeviceInfo($DevInfo);            }            if ($res > 0) {                $data['message'] = "Admin will recieve your DeviceInfo shortly";                $data['success'] = TRUE;            }        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }    public function checkUser() {        $mobile = $_POST['mobile_number'];        $mem = mysql_query("SELECT user_id FROM manage_users WHERE phone = '" . $mobile . "'");        $num = mysql_num_rows($mem);        if ($num > 0) {            echo 'error';        } else {            echo 'success';        }    }    public function lat_long() {//        header('Content-Type:application/json');        echo "hewewre";die();        $postData = array();        if ($_SERVER['REQUEST_METHOD'] == 'POST') {            $postData = json_decode(file_get_contents("php://input"));            $postData = (array) $postData;        }        if (isset($postData['custId']) && $postData['custId'] != '' && isset($postData['lat']) && $postData['lat'] != "" && isset($postData['longi']) && $postData['longi'] != "") {            $custId = $postData['custId'];            $lat = $postData['lat'];            $longi = $postData['longi'];            $address = $postData['address'];            $sublocality = $postData['sublocality'];            $pincode = $postData['pincode'];            $city = $postData['city'];            $state = $postData['state'];            $country = $postData['country'];//            mysql_query("UPDATE manage_users SET lat='$lat',longi='$longi' WHERE user_id='$custId'");            $insert_query = "INSERT INTO manage_user_location (custId,lat,longi,address,sublocality,pincode,city,state,country) VALUES($custId,'$lat','$longi','$address','$sublocality','$pincode','$city','$state','$country')";            mysql_query($insert_query);            $data['message'] = "Lat long added successfully";            $data['success'] = TRUE;        } else {            $data['message'] = "Parameter Missing";            $data['success'] = FALSE;        }        echo json_encode($data);    }}$Web = new web_api();?>
